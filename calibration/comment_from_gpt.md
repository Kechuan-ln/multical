你这份“批判性分析”写得很扎实👍。我认真读完并对照你现有 pipeline 后（含 `fix_intrinsic` 外参BA、低光 PrimeColor 的 CLAHE、timecode/QR 双同步、`charuco_b1_2_dark.yaml` 等），下面给出**更精确、可落地**的结论与改进清单。

# 先给结论（简版）

* **关于误差判定**：RMS 1.4–2.0 px 对“GoPro（Linear）+ 打印 Charuco”组合是**合理区间**；我之前把它定性为“核心隐患”确实偏严，收回这个表述。
* **优先级**：你文档里的排序更合理——**先做低成本高收益**：稳健损失（robust loss）+ 数据采集覆盖与连通性检查 + 同步与板面质量复核。
* **镜头模型**：不必直接切换 fisheye。更推荐**先 A/B 对比 `standard` vs `rational(8参数)`**；仅当出现明显“边缘残差膨胀”且 rational 仍压不住时，再试 fisheye。
* **两阶段BA**：有价值但要**加约束**地做（只放开极小量参数、或加正则），避免把系统性误差“吸进”内参。
* **我遗漏处**：你指出的**同步误差**、**标定板平整/几何误差**、**角点亚像素细化设置**，确实是关键噪声源，应进“必检项”。

下面是**精确、一步步可操作**的改进表（不改你总体架构，只动小地方）。

---

# 一、把 RMS 拉到更稳定的 1.0–1.3 px 区间（低成本高收益）

## 1) 开启稳健损失（关键！）

你当前用的是 `scipy.optimize.least_squares(..., method='lm')`；注意**LM 方法不支持非线性稳健损失**（`loss='huber'/'cauchy'` 只有 `method='trf'/'dogbox'` 才会生效）。所以需要两处改动：

* 把 `method='lm'` → `method='trf'`
* 加 `loss='huber', f_scale≈1.0`（或 `loss='cauchy'`）

> 这一步通常能直接把 RMS 从 ~1.4–2.0 拉到 ~1.0–1.5，且**抗 PrimeColor 异常帧**非常明显。
> 对既有代码的侵入仅 2 行修改，风险几乎为零。

## 2) 数据采集与覆盖“硬指标”

保持你现有帧数（300–800）即可，但**加入“采样质量红线”**，拍完即刻做自检：

* **连通性**：任意相机对**共视帧 ≥ 20**；整图**强连通**。
* **距离分布**：近（0.5–1 m）≥30%，中（1–2 m）≥50%，远（2–4 m）≥20%。
* **角度分布**：倾斜 15–45° 的帧 ≥50%，大倾斜 45–60° ≥20%。
* **空间覆盖**：角点热力图显示边/角落也有充分击中。

> 这些检查可以在你现有 `vis/` 产出基础上加一个快速统计脚本（不影响主流程）。

## 3) 同步误差快速体检（必须过这一关）

用你 QR/timecode 的同步结果，做一个**“RMS 随时间曲线”**：若高误差段与标定板快速运动段同相，极可能是 ±1 帧错位（60 fps 即 16–33 ms）。
经验估算（你也给出了）：板速 0.1 m/s × 33 ms ≈ 3.3 mm → 投影约 **~2.8 px**，这能解释你很多峰值误差。
→ 发现问题就**只裁剪/重对齐那段**，不必重跑全流程。

## 4) 标定板“物理”质量确认

* 大幅面（B1）一定要**刚性背板**+ 边缘固定；
* 用直尺+侧拍判断是否有翘曲；
* 允许的话测一次实际方格尺寸与 YAML 中数值的偏差（±0.1–0.5 mm 的系统误差就能贡献 0.2–0.5 px）。
  → 确认后继续沿用你现有 `charuco_b1_2_dark.yaml` 配置是对的。

---

# 二、镜头模型与 BA 策略（谨慎推进，先做对比）

## 5) 先试 `rational`，再考虑 fisheye

你的 GoPro 处在 **Linear 输出**，不是原始超广角 RAW。大多数情况下：

* `standard(5)` 已够用；
* 若**边缘残差显著 > 中心 ×2**，先试 **`rational`(k1–k6,p1,p2)**；
* 只有当 rational 也压不住“边缘抬升”，再 A/B 对比 **`fisheye`(k1–k4)**。

> 做一个**半小时 A/B 测试**：固定同一批 200 帧/3 台相机，分别跑 standard / rational / fisheye，统计
>
> * 全局 RMS、
> * **半径分桶**残差（按 r/最大半径 分 5 桶），
> * **留一姿态**的外推误差（hold-out 一组板姿态作验证）。
>   选“**边缘不过拟合**且**留出集表现最好**”的模型。

## 6) 两阶段 BA 但**有限放参**（必要时）

若你重标内参 vs 预存内参差异 **>~1–2%**，再考虑二阶段：

* Stage-1：`fix_intrinsic`（已做）
* Stage-2：**只放开 per-camera 的 (cx, cy)** 或 **fx 与 fy 的公共尺度**，并**加小幅正则**（如对偏离量加 L2 penalty），防止把外参/同步/板误差“吸进内参”。

---

# 三、角点检测与亚像素细化（把“下界”做实）

## 7) 提升亚像素细化强度（低风险提纯）

在 ChArUco 插值成功后，把 `cornerSubPix` 的窗口和迭代放宽些：

* `winSize=(11,11)`、`max_iter=100`、`epsilon=1e-4`（你目前常见默认是 5×5 / 30 / 1e-3）。
  低光或轻微模糊场景下，这能把**单点定位噪声**从 ~0.5 px 压到 **~0.3 px**。

## 8) PrimeColor 的 CLAHE 保留，但**防过度**

继续使用你已集成的 LAB-CLAHE（clipLimit≈3, tile≈8×8）；对极暗帧再叠加轻量 Gamma（1.2–1.4）时要观察是否引入“亮边 halo”。你已有完整集成点，非常好。

---

# 四、判定“是否够好”的标准（给你一把标尺）

若满足下列条件，我建议**就地收兵**（别再追 Fisheye/RAW 了）：

* **全局 RMS**：1.0–1.3 px（偶发峰值可忽略）
* **近 vs 远**：近/远 RMS 比 < 1.5
* **中心 vs 边缘**：最大半径桶的 RMS 不超过中心桶 ×1.7
* **三角化误差**：静态板角点 3D RMSE < **3 mm**（2 m 工作距离、fx≈1700 px 的条件下）
* **连通性**：任意相机对共视 ≥20 帧，整图强连通
* **可复现**：换一批帧/换一天再做一次，误差涨幅 < 20%

---

# 五、我修正与补充的态度声明

* 我之前把 1.7–2.0 px 直接定性为“核心隐患”是**过度要求**；在你的硬件与板材前提下，这确实处于**正常偏上**的区间。
* “Linear 就一定要 fisheye”的建议**不应默认**；应以**残差半径曲线**与 **rational 的对比结果**来决策。
* “两阶段BA放开 fx,cx,cy”**可做但要加约束**，且建立在**先复核内参一致性**的基础上。
* 你指出的**同步、板面几何、角点亚像素**是**我遗漏的实操要点**，我完全赞同并已纳入本次建议序列。

---

# 最小改动清单（今天就能上的那种）

1. **把 BA 的 `method='lm'` → `method='trf'`，加 `loss='huber', f_scale=1.0`**（或 `cauchy`）。
2. **加一张“残差 vs 图像半径”图**与**RMS 随时间图**（定位是否模型不匹配/同步偏差）。
3. **角点亚像素参数**放宽到 `(11,11)` / `100` / `1e-4`。
4. **连通性与覆盖统计**（最小脚本），不达标就补拍“近距+大倾角”。
5. 若边缘残差依旧显著：跑一轮 **`rational` 对比**；只有在它也不行时才试 **fisheye**。

做到这 5 条，你极可能稳定在 **1.0–1.3 px**，且近距离错误不再“出格”。同时不破坏你成熟的整体流程与代码组织（含 `run_gopro_primecolor_calibration.py`、`charuco_b1_2_dark.yaml`、CLAHE 集成等）。

如果你愿意，我可以把**“残差半径曲线 + 时间曲线 + 连通性热力图”的三合一诊断脚本**按你项目结构直接写成 `multical/tools/diagnose_residuals.py` 的落地版，参数读取沿用你现有的工作区与 `calibration.json`。
